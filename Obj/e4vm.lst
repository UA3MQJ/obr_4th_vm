                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 3.9.3 #11378 (MINGW32)
                              4 ;--------------------------------------------------------
                              5 	.module e4vm
                              6 	.optsdcc -mz80
                              7 	
                              8 ;--------------------------------------------------------
                              9 ; Public variables in this module
                             10 ;--------------------------------------------------------
                             11 	.globl _main
                             12 	.globl _e4vm_core_ext__init
                             13 	.globl _e4vm_core_ext_do_lit
                             14 	.globl _e4vm_boolean__init
                             15 	.globl _e4vm_math__init
                             16 	.globl _e4vm_stack__init
                             17 	.globl _e4vm_utils__init
                             18 	.globl _e4vm_utils_vm_stat
                             19 	.globl _e4vm_utils_init
                             20 	.globl _e4vm_core__init
                             21 	.globl _e4vm_core_do_nop
                             22 	.globl _e4vm_core_do_next
                             23 	.globl _e4vm_core_do_list
                             24 	.globl _e4vm_core_do_exit
                             25 	.globl _Basic_Quit_IM1
                             26 	.globl _Basic_PAUSE_EI
                             27 	.globl _Console_Clear_COMPACT
                             28 	.globl _Console_WriteStr_C_COMPACT
                             29 	.globl _Console_WriteLn_COMPACT
                             30 ;--------------------------------------------------------
                             31 ; special function registers
                             32 ;--------------------------------------------------------
                             33 ;--------------------------------------------------------
                             34 ; ram data
                             35 ;--------------------------------------------------------
                             36 	.area _DATA
   0000                      37 _e4vm_vm_static:
   0000                      38 	.ds 269
   010D                      39 _e4vm_vm:
   010D                      40 	.ds 2
                             41 ;--------------------------------------------------------
                             42 ; ram data
                             43 ;--------------------------------------------------------
                             44 	.area _INITIALIZED
                             45 ;--------------------------------------------------------
                             46 ; absolute external ram data
                             47 ;--------------------------------------------------------
                             48 	.area _DABS (ABS)
                             49 ;--------------------------------------------------------
                             50 ; global & static initialisations
                             51 ;--------------------------------------------------------
                             52 	.area _HOME
                             53 	.area _GSINIT
                             54 	.area _GSFINAL
                             55 	.area _GSINIT
                             56 ;--------------------------------------------------------
                             57 ; Home
                             58 ;--------------------------------------------------------
                             59 	.area _HOME
                             60 	.area _HOME
                             61 ;--------------------------------------------------------
                             62 ; code
                             63 ;--------------------------------------------------------
                             64 	.area _CODE
                             65 ;e4vm.c:26: static void e4vm_do_hello (e4vm_type_x4thPtr *v)
                             66 ;	---------------------------------
                             67 ; Function e4vm_do_hello
                             68 ; ---------------------------------
   0000                      69 _e4vm_do_hello:
   0000 CDr00r00      [17]   70 	call	___sdcc_enter_ix
                             71 ;e4vm.c:28: Console_WriteStrLn((CHAR*)"hello!", 7);
   0003 21r0Er00      [10]   72 	ld	hl, #___str_0
   0006 CDr00r00      [17]   73 	call	_Console_WriteStr_C_COMPACT
                             74 ;e4vm.c:29: }
   0009 DD E1         [14]   75 	pop	ix
   000B C3r00r00      [10]   76 	jp	_Console_WriteLn_COMPACT
   000E                      77 ___str_0:
   000E 68 65 6C 6C 6F 21    78 	.ascii "hello!"
   0014 00                   79 	.db 0x00
                             80 ;e4vm.c:31: static void e4vm_test_dolit (e4vm_type_x4thPtr *v)
                             81 ;	---------------------------------
                             82 ; Function e4vm_test_dolit
                             83 ; ---------------------------------
   0015                      84 _e4vm_test_dolit:
   0015 CDr00r00      [17]   85 	call	___sdcc_enter_ix
                             86 ;e4vm.c:33: Console_WriteStr((CHAR*)"dolit ", 7);
   0018 21r58r01      [10]   87 	ld	hl, #___str_1
   001B CDr00r00      [17]   88 	call	_Console_WriteStr_C_COMPACT
                             89 ;e4vm.c:34: e4vm_utils_init(v);
   001E DD 6E 04      [19]   90 	ld	l, 4 (ix)
   0021 DD 66 05      [19]   91 	ld	h, 5 (ix)
   0024 E5            [11]   92 	push	hl
   0025 CDr00r00      [17]   93 	call	_e4vm_utils_init
   0028 F1            [10]   94 	pop	af
                             95 ;e4vm.c:35: (*v)->core[0] = e4vm_core_do_nop;
   0029 DD 4E 04      [19]   96 	ld	c, 4 (ix)
   002C DD 46 05      [19]   97 	ld	b, 5 (ix)
   002F 69            [ 4]   98 	ld	l, c
   0030 60            [ 4]   99 	ld	h, b
   0031 5E            [ 7]  100 	ld	e, (hl)
   0032 23            [ 6]  101 	inc	hl
   0033 56            [ 7]  102 	ld	d, (hl)
   0034 21 CD 00      [10]  103 	ld	hl, #0x00cd
   0037 19            [11]  104 	add	hl, de
   0038 EB            [ 4]  105 	ex	de, hl
   0039 3Er00         [ 7]  106 	ld	a, #<(_e4vm_core_do_nop)
   003B 12            [ 7]  107 	ld	(de), a
   003C 13            [ 6]  108 	inc	de
   003D 3Es00         [ 7]  109 	ld	a, #>(_e4vm_core_do_nop)
   003F 12            [ 7]  110 	ld	(de), a
                            111 ;e4vm.c:36: (*v)->core[1] = e4vm_core_do_next;
   0040 69            [ 4]  112 	ld	l, c
   0041 60            [ 4]  113 	ld	h, b
   0042 5E            [ 7]  114 	ld	e, (hl)
   0043 23            [ 6]  115 	inc	hl
   0044 56            [ 7]  116 	ld	d, (hl)
   0045 21 CF 00      [10]  117 	ld	hl, #0x00cf
   0048 19            [11]  118 	add	hl, de
   0049 EB            [ 4]  119 	ex	de, hl
   004A 3Er00         [ 7]  120 	ld	a, #<(_e4vm_core_do_next)
   004C 12            [ 7]  121 	ld	(de), a
   004D 13            [ 6]  122 	inc	de
   004E 3Es00         [ 7]  123 	ld	a, #>(_e4vm_core_do_next)
   0050 12            [ 7]  124 	ld	(de), a
                            125 ;e4vm.c:37: (*v)->core[2] = e4vm_core_do_list;
   0051 69            [ 4]  126 	ld	l, c
   0052 60            [ 4]  127 	ld	h, b
   0053 5E            [ 7]  128 	ld	e, (hl)
   0054 23            [ 6]  129 	inc	hl
   0055 56            [ 7]  130 	ld	d, (hl)
   0056 21 D1 00      [10]  131 	ld	hl, #0x00d1
   0059 19            [11]  132 	add	hl, de
   005A EB            [ 4]  133 	ex	de, hl
   005B 3Er00         [ 7]  134 	ld	a, #<(_e4vm_core_do_list)
   005D 12            [ 7]  135 	ld	(de), a
   005E 13            [ 6]  136 	inc	de
   005F 3Es00         [ 7]  137 	ld	a, #>(_e4vm_core_do_list)
   0061 12            [ 7]  138 	ld	(de), a
                            139 ;e4vm.c:38: (*v)->core[3] = e4vm_core_do_exit;
   0062 69            [ 4]  140 	ld	l, c
   0063 60            [ 4]  141 	ld	h, b
   0064 5E            [ 7]  142 	ld	e, (hl)
   0065 23            [ 6]  143 	inc	hl
   0066 56            [ 7]  144 	ld	d, (hl)
   0067 21 D3 00      [10]  145 	ld	hl, #0x00d3
   006A 19            [11]  146 	add	hl, de
   006B EB            [ 4]  147 	ex	de, hl
   006C 3Er00         [ 7]  148 	ld	a, #<(_e4vm_core_do_exit)
   006E 12            [ 7]  149 	ld	(de), a
   006F 13            [ 6]  150 	inc	de
   0070 3Es00         [ 7]  151 	ld	a, #>(_e4vm_core_do_exit)
   0072 12            [ 7]  152 	ld	(de), a
                            153 ;e4vm.c:39: (*v)->core[4] = e4vm_core_ext_do_lit;
   0073 69            [ 4]  154 	ld	l, c
   0074 60            [ 4]  155 	ld	h, b
   0075 5E            [ 7]  156 	ld	e, (hl)
   0076 23            [ 6]  157 	inc	hl
   0077 56            [ 7]  158 	ld	d, (hl)
   0078 21 D5 00      [10]  159 	ld	hl, #0x00d5
   007B 19            [11]  160 	add	hl, de
   007C EB            [ 4]  161 	ex	de, hl
   007D 3Er00         [ 7]  162 	ld	a, #<(_e4vm_core_ext_do_lit)
   007F 12            [ 7]  163 	ld	(de), a
   0080 13            [ 6]  164 	inc	de
   0081 3Es00         [ 7]  165 	ld	a, #>(_e4vm_core_ext_do_lit)
   0083 12            [ 7]  166 	ld	(de), a
                            167 ;e4vm.c:40: (*v)->mem[0] = 0;
   0084 69            [ 4]  168 	ld	l, c
   0085 60            [ 4]  169 	ld	h, b
   0086 5E            [ 7]  170 	ld	e, (hl)
   0087 23            [ 6]  171 	inc	hl
   0088 56            [ 7]  172 	ld	d, (hl)
   0089 21 8A 00      [10]  173 	ld	hl, #0x008a
   008C 19            [11]  174 	add	hl, de
   008D AF            [ 4]  175 	xor	a, a
   008E 77            [ 7]  176 	ld	(hl), a
   008F 23            [ 6]  177 	inc	hl
   0090 77            [ 7]  178 	ld	(hl), a
                            179 ;e4vm.c:41: (*v)->mem[1] = 1;
   0091 69            [ 4]  180 	ld	l, c
   0092 60            [ 4]  181 	ld	h, b
   0093 5E            [ 7]  182 	ld	e, (hl)
   0094 23            [ 6]  183 	inc	hl
   0095 56            [ 7]  184 	ld	d, (hl)
   0096 21 8C 00      [10]  185 	ld	hl, #0x008c
   0099 19            [11]  186 	add	hl, de
   009A 36 01         [10]  187 	ld	(hl), #0x01
   009C 23            [ 6]  188 	inc	hl
   009D 36 00         [10]  189 	ld	(hl), #0x00
                            190 ;e4vm.c:42: (*v)->mem[2] = 2;
   009F 69            [ 4]  191 	ld	l, c
   00A0 60            [ 4]  192 	ld	h, b
   00A1 5E            [ 7]  193 	ld	e, (hl)
   00A2 23            [ 6]  194 	inc	hl
   00A3 56            [ 7]  195 	ld	d, (hl)
   00A4 21 8E 00      [10]  196 	ld	hl, #0x008e
   00A7 19            [11]  197 	add	hl, de
   00A8 36 02         [10]  198 	ld	(hl), #0x02
   00AA 23            [ 6]  199 	inc	hl
   00AB 36 00         [10]  200 	ld	(hl), #0x00
                            201 ;e4vm.c:43: (*v)->mem[3] = 3;
   00AD 69            [ 4]  202 	ld	l, c
   00AE 60            [ 4]  203 	ld	h, b
   00AF 5E            [ 7]  204 	ld	e, (hl)
   00B0 23            [ 6]  205 	inc	hl
   00B1 56            [ 7]  206 	ld	d, (hl)
   00B2 21 90 00      [10]  207 	ld	hl, #0x0090
   00B5 19            [11]  208 	add	hl, de
   00B6 36 03         [10]  209 	ld	(hl), #0x03
   00B8 23            [ 6]  210 	inc	hl
   00B9 36 00         [10]  211 	ld	(hl), #0x00
                            212 ;e4vm.c:44: (*v)->mem[4] = 4;
   00BB 69            [ 4]  213 	ld	l, c
   00BC 60            [ 4]  214 	ld	h, b
   00BD 5E            [ 7]  215 	ld	e, (hl)
   00BE 23            [ 6]  216 	inc	hl
   00BF 56            [ 7]  217 	ld	d, (hl)
   00C0 21 92 00      [10]  218 	ld	hl, #0x0092
   00C3 19            [11]  219 	add	hl, de
   00C4 36 04         [10]  220 	ld	(hl), #0x04
   00C6 23            [ 6]  221 	inc	hl
   00C7 36 00         [10]  222 	ld	(hl), #0x00
                            223 ;e4vm.c:45: (*v)->wp = 4;
   00C9 69            [ 4]  224 	ld	l, c
   00CA 60            [ 4]  225 	ld	h, b
   00CB 5E            [ 7]  226 	ld	e, (hl)
   00CC 23            [ 6]  227 	inc	hl
   00CD 56            [ 7]  228 	ld	d, (hl)
   00CE 13            [ 6]  229 	inc	de
   00CF 13            [ 6]  230 	inc	de
   00D0 62            [ 4]  231 	ld	h, d
   00D1 6B            [ 4]  232 	ld	l, e
   00D2 36 04         [10]  233 	ld	(hl), #0x04
   00D4 23            [ 6]  234 	inc	hl
   00D5 36 00         [10]  235 	ld	(hl), #0x00
                            236 ;e4vm.c:46: (*v)->mem[5] = 2;
   00D7 69            [ 4]  237 	ld	l, c
   00D8 60            [ 4]  238 	ld	h, b
   00D9 5E            [ 7]  239 	ld	e, (hl)
   00DA 23            [ 6]  240 	inc	hl
   00DB 56            [ 7]  241 	ld	d, (hl)
   00DC 21 94 00      [10]  242 	ld	hl, #0x0094
   00DF 19            [11]  243 	add	hl, de
   00E0 36 02         [10]  244 	ld	(hl), #0x02
   00E2 23            [ 6]  245 	inc	hl
   00E3 36 00         [10]  246 	ld	(hl), #0x00
                            247 ;e4vm.c:47: (*v)->mem[6] = 4;
   00E5 69            [ 4]  248 	ld	l, c
   00E6 60            [ 4]  249 	ld	h, b
   00E7 5E            [ 7]  250 	ld	e, (hl)
   00E8 23            [ 6]  251 	inc	hl
   00E9 56            [ 7]  252 	ld	d, (hl)
   00EA 21 96 00      [10]  253 	ld	hl, #0x0096
   00ED 19            [11]  254 	add	hl, de
   00EE 36 04         [10]  255 	ld	(hl), #0x04
   00F0 23            [ 6]  256 	inc	hl
   00F1 36 00         [10]  257 	ld	(hl), #0x00
                            258 ;e4vm.c:48: (*v)->mem[7] = 555;
   00F3 69            [ 4]  259 	ld	l, c
   00F4 60            [ 4]  260 	ld	h, b
   00F5 5E            [ 7]  261 	ld	e, (hl)
   00F6 23            [ 6]  262 	inc	hl
   00F7 56            [ 7]  263 	ld	d, (hl)
   00F8 21 98 00      [10]  264 	ld	hl, #0x0098
   00FB 19            [11]  265 	add	hl, de
   00FC 36 2B         [10]  266 	ld	(hl), #0x2b
   00FE 23            [ 6]  267 	inc	hl
   00FF 36 02         [10]  268 	ld	(hl), #0x02
                            269 ;e4vm.c:49: (*v)->mem[8] = 3;
   0101 69            [ 4]  270 	ld	l, c
   0102 60            [ 4]  271 	ld	h, b
   0103 5E            [ 7]  272 	ld	e, (hl)
   0104 23            [ 6]  273 	inc	hl
   0105 56            [ 7]  274 	ld	d, (hl)
   0106 21 9A 00      [10]  275 	ld	hl, #0x009a
   0109 19            [11]  276 	add	hl, de
   010A 36 03         [10]  277 	ld	(hl), #0x03
   010C 23            [ 6]  278 	inc	hl
   010D 36 00         [10]  279 	ld	(hl), #0x00
                            280 ;e4vm.c:50: e4vm_core_do_list(v);
   010F C5            [11]  281 	push	bc
   0110 C5            [11]  282 	push	bc
   0111 CDr00r00      [17]  283 	call	_e4vm_core_do_list
   0114 F1            [10]  284 	pop	af
   0115 DD 6E 04      [19]  285 	ld	l, 4 (ix)
   0118 DD 66 05      [19]  286 	ld	h, 5 (ix)
   011B E5            [11]  287 	push	hl
   011C CDr00r00      [17]  288 	call	_e4vm_core_do_next
   011F F1            [10]  289 	pop	af
   0120 DD 6E 04      [19]  290 	ld	l, 4 (ix)
   0123 DD 66 05      [19]  291 	ld	h, 5 (ix)
   0126 E5            [11]  292 	push	hl
   0127 CDr00r00      [17]  293 	call	_e4vm_utils_vm_stat
   012A F1            [10]  294 	pop	af
                            295 ;e4vm.c:53: if ((*v)->ds[0] == 555) {
   012B E1            [10]  296 	pop	hl
   012C 4E            [ 7]  297 	ld	c, (hl)
   012D 23            [ 6]  298 	inc	hl
   012E 66            [ 7]  299 	ld	h, (hl)
   012F 69            [ 4]  300 	ld	l, c
   0130 11 44 00      [10]  301 	ld	de, #0x0044
   0133 19            [11]  302 	add	hl, de
   0134 4E            [ 7]  303 	ld	c, (hl)
   0135 23            [ 6]  304 	inc	hl
   0136 46            [ 7]  305 	ld	b, (hl)
   0137 79            [ 4]  306 	ld	a, c
   0138 D6 2B         [ 7]  307 	sub	a, #0x2b
   013A 20 10         [12]  308 	jr	NZ,00102$
   013C 78            [ 4]  309 	ld	a, b
   013D D6 02         [ 7]  310 	sub	a, #0x02
   013F 20 0B         [12]  311 	jr	NZ,00102$
                            312 ;e4vm.c:54: Console_WriteStrLn((CHAR*)" - ok", 6);
   0141 21r5Fr01      [10]  313 	ld	hl, #___str_2
   0144 CDr00r00      [17]  314 	call	_Console_WriteStr_C_COMPACT
   0147 CDr00r00      [17]  315 	call	_Console_WriteLn_COMPACT
   014A 18 09         [12]  316 	jr	00104$
   014C                     317 00102$:
                            318 ;e4vm.c:56: Console_WriteStrLn((CHAR*)" - error", 9);
   014C 21r65r01      [10]  319 	ld	hl, #___str_3
   014F CDr00r00      [17]  320 	call	_Console_WriteStr_C_COMPACT
   0152 CDr00r00      [17]  321 	call	_Console_WriteLn_COMPACT
   0155                     322 00104$:
                            323 ;e4vm.c:58: }
   0155 DD E1         [14]  324 	pop	ix
   0157 C9            [10]  325 	ret
   0158                     326 ___str_1:
   0158 64 6F 6C 69 74 20   327 	.ascii "dolit "
   015E 00                  328 	.db 0x00
   015F                     329 ___str_2:
   015F 20 2D 20 6F 6B      330 	.ascii " - ok"
   0164 00                  331 	.db 0x00
   0165                     332 ___str_3:
   0165 20 2D 20 65 72 72   333 	.ascii " - error"
        6F 72
   016D 00                  334 	.db 0x00
                            335 ;e4vm.c:61: int main (int argc, char **argv)
                            336 ;	---------------------------------
                            337 ; Function main
                            338 ; ---------------------------------
   016E                     339 _main::
                            340 ;e4vm.c:66: __IMPORT(e4vm_boolean__init);
   016E CDr00r00      [17]  341 	call	_e4vm_boolean__init
                            342 ;e4vm.c:67: __IMPORT(e4vm_core__init);
   0171 CDr00r00      [17]  343 	call	_e4vm_core__init
                            344 ;e4vm.c:68: __IMPORT(e4vm_core_ext__init);
   0174 CDr00r00      [17]  345 	call	_e4vm_core_ext__init
                            346 ;e4vm.c:69: __IMPORT(e4vm_math__init);
   0177 CDr00r00      [17]  347 	call	_e4vm_math__init
                            348 ;e4vm.c:70: __IMPORT(e4vm_stack__init);
   017A CDr00r00      [17]  349 	call	_e4vm_stack__init
                            350 ;e4vm.c:71: __IMPORT(e4vm_utils__init);
   017D CDr00r00      [17]  351 	call	_e4vm_utils__init
                            352 ;e4vm.c:74: Basic_Init();
   0180 FD CB 01 A6   [23]  353 	res	4,1(iy) 
   0184 CD 42 16      [17]  354 	call 0x1642 
                            355 ;e4vm.c:75: Console_Clear(7);
   0187 2E 07         [ 7]  356 	ld	l, #0x07
   0189 CDr00r00      [17]  357 	call	_Console_Clear_COMPACT
                            358 ;e4vm.c:76: Console_SetColors(56);
   018C 21r00r00      [10]  359 	ld	hl, #_Console_attrib
   018F 36 38         [10]  360 	ld	(hl), #0x38
                            361 ;e4vm.c:77: e4vm_vm = (e4vm_type_x4thPtr)((SYSTEM_ADRINT)&e4vm_vm_static);
   0191 21r00r00      [10]  362 	ld	hl, #_e4vm_vm_static
   0194 22r0Dr01      [16]  363 	ld	(_e4vm_vm), hl
                            364 ;e4vm.c:78: e4vm_test_dolit(&e4vm_vm);
   0197 21r0Dr01      [10]  365 	ld	hl, #_e4vm_vm
   019A E5            [11]  366 	push	hl
   019B CDr15r00      [17]  367 	call	_e4vm_test_dolit
   019E F1            [10]  368 	pop	af
                            369 ;e4vm.c:79: Basic_PAUSE(0);
   019F 21 00 00      [10]  370 	ld	hl, #0x0000
   01A2 CDr00r00      [17]  371 	call	_Basic_PAUSE_EI
                            372 ;e4vm.c:80: Basic_Quit();
                            373 ;e4vm.c:81: __FINI;
                            374 ;e4vm.c:82: }
   01A5 C3r00r00      [10]  375 	jp  _Basic_Quit_IM1
                            376 	.area _CODE
                            377 	.area _INITIALIZER
                            378 	.area _CABS (ABS)
